<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìä Dashboard - To-Do Pro</title>

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --cream-bg: #faf8f5;
      --dark-bg: #1f1f1f;
      --dark-card: #2a2a2a;
      --accent: #e0c097;
      --text-dark: #444;
      --text-light: #f5f5f5;
      --shadow-light: rgba(0, 0, 0, 0.05);
    }

    body {
      font-family: 'Sarabun', sans-serif;
      background-color: var(--cream-bg);
      color: var(--text-dark);
      margin: 0;
      transition: background 0.4s, color 0.4s;
    }
    body.dark { background-color: var(--dark-bg); color: var(--text-light); }

    header {
      text-align: center;
      padding: 15px;
      background: var(--accent);
      color: white;
      font-size: 20px;
      font-weight: 600;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    .top-buttons {
      display: flex;
      justify-content: space-between;
      padding: 10px 20px;
    }
    .top-buttons button {
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      color: var(--accent);
      transition: 0.3s;
    }
    .top-buttons button:hover { transform: scale(1.1); }

    /* üîπ ‡πÅ‡∏ó‡πá‡∏ö */
    .tabs {
      display: flex;
      justify-content: center;
      border-bottom: 2px solid #ddd;
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(5px);
      position: sticky;
      top: 60px;
      z-index: 40;
    }

    .tab-btn {
      flex: 1;
      padding: 14px;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* üî∏ ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ó‡πá‡∏ö */
    .tab-content {
      display: none;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }
    .tab-content.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
    }
    .summary-card {
      background: #fff;
      border: 2px solid var(--accent);
      border-radius: 15px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 8px var(--shadow-light);
      transition: 0.3s;
    }
    .summary-card:hover { transform: translateY(-5px); }
    body.dark .summary-card { background: var(--dark-card); }

    .summary-card h2 {
      margin: 5px 0;
      font-size: 28px;
      color: var(--accent);
    }
    .summary-card p {
      margin: 0;
      font-size: 14px;
    }

    /* üü° ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏° */
    .progress-circle {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 40px auto;
    }

    .progress-circle svg {
      transform: rotate(-90deg);
      width: 160px;
      height: 160px;
    }

    .progress-circle circle {
      fill: none;
      stroke-width: 12;
      stroke-linecap: round;
    }

    .progress-bg {
      stroke: #e8e4dc;
    }
    .progress-bar {
      stroke: var(--accent);
      stroke-dasharray: 502;
      stroke-dashoffset: 502;
      transition: stroke-dashoffset 0.8s ease;
    }
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 22px;
      font-weight: 600;
      color: var(--text-dark);
    }
    body.dark .progress-text { color: var(--text-light); }

    /* üìä ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° */
    .chart-line {
      width: 100%;
      height: 180px;
      background: linear-gradient(to bottom, #fefaf4, #faf8f5);
      border-radius: 12px;
      box-shadow: 0 2px 6px var(--shadow-light);
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 10px;
    }

    .bar {
      width: 10%;
      background-color: var(--accent);
      border-radius: 6px 6px 0 0;
      transition: height 0.5s ease;
    }

    .bar-label {
      text-align: center;
      font-size: 12px;
      margin-top: 6px;
      color: #666;
    }

    footer {
      text-align: center;
      padding: 15px;
      font-size: 13px;
      opacity: 0.7;
    }

    /* üì± Responsive */
    @media (max-width: 600px) {
      .summary-card h2 { font-size: 22px; }
      .progress-circle { width: 130px; height: 130px; }
      .tab-btn { font-size: 14px; padding: 10px; }
    }
  </style>
</head>

<body>
  <header>üìä Dashboard</header>
  <div class="top-buttons">
    <button onclick="location.href='index.html'">üè†</button>
    <button onclick="location.href='settings.html'">‚öôÔ∏è</button>
  </div>

  <!-- üîπ Tabs -->
  <div class="tabs">
    <div class="tab-btn active" onclick="openTab('summary')">‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô</div>
    <div class="tab-btn" onclick="openTab('progress')">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</div>
    <div class="tab-btn" onclick="openTab('trend')">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</div>
  </div>

  <!-- üî∏ Tab 1: Summary -->
  <div class="tab-content active" id="summary">
    <h3>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <div class="summary-grid" id="summaryGrid"></div>
  </div>

  <!-- üî∏ Tab 2: Progress -->
  <div class="tab-content" id="progress">
    <h3>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏ß‡∏°</h3>
    <div class="progress-circle">
      <svg>
        <circle class="progress-bg" cx="80" cy="80" r="80"></circle>
        <circle class="progress-bar" cx="80" cy="80" r="80"></circle>
      </svg>
      <div class="progress-text" id="progressText">0%</div>
    </div>
  </div>

  <!-- üî∏ Tab 3: Trend -->
  <div class="tab-content" id="trend">
    <h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô</h3>
    <div class="chart-line" id="chartLine"></div>
  </div>

  <footer>¬© To-Do Pro Dashboard</footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, getDocs } 
      from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
      authDomain: "my-todo-list-9d2fa.firebaseapp.com",
      projectId: "my-todo-list-9d2fa",
      storageBucket: "my-todo-list-9d2fa.appspot.com",
      messagingSenderId: "631403892452",
      appId: "1:631403892452:web:66d382bf5f143fc05de6f1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let allTasks = [];

    async function loadData() {
      const snapshot = await getDocs(collection(db, "tasks"));
      allTasks = snapshot.docs.map(doc => doc.data());
      updateSummary();
      updateProgress();
      updateTrend();
    }

    function updateSummary() {
      const total = allTasks.length;
      const done = allTasks.filter(t => t.completed).length;
      const work = allTasks.filter(t => t.category === "work").length;
      const personal = allTasks.filter(t => t.category === "personal").length;

      const html = `
        <div class="summary-card"><h2>${total}</h2><p>‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div>
        <div class="summary-card"><h2>${done}</h2><p>‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p></div>
        <div class="summary-card"><h2>${total - done}</h2><p>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p></div>
        <div class="summary-card"><h2>${work}</h2><p>‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</p></div>
        <div class="summary-card"><h2>${personal}</h2><p>‡∏´‡∏°‡∏ß‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</p></div>
      `;
      document.getElementById("summaryGrid").innerHTML = html;
    }

    function updateProgress() {
      const total = allTasks.length;
      const done = allTasks.filter(t => t.completed).length;
      const percent = total ? Math.round((done / total) * 100) : 0;
      const circle = document.querySelector(".progress-bar");
      const offset = 502 - (502 * percent) / 100;
      circle.style.strokeDashoffset = offset;
      document.getElementById("progressText").textContent = percent + "%";
    }

    function updateTrend() {
      const chart = document.getElementById("chartLine");
      const today = new Date();
      const days = [...Array(7)].map((_, i) => {
        const d = new Date(today);
        d.setDate(today.getDate() - (6 - i));
        return d.toISOString().slice(0, 10);
      });

      const data = days.map(day => {
        return allTasks.filter(t => {
          if (!t.completed || !t.createdAt) return false;
          const d = new Date(t.createdAt.seconds ? t.createdAt.seconds * 1000 : t.createdAt);
          return d.toISOString().slice(0,10) === day;
        }).length;
      });

      chart.innerHTML = "";
      const max = Math.max(...data, 1);
      days.forEach((day, i) => {
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.height = `${(data[i] / max) * 100}%`;

        const label = document.createElement("div");
        label.className = "bar-label";
        label.textContent = new Date(day).toLocaleDateString("th-TH", { weekday: "short" });

        const container = document.createElement("div");
        container.style.display = "flex";
        container.style.flexDirection = "column";
        container.style.alignItems = "center";
        container.appendChild(bar);
        container.appendChild(label);
        chart.appendChild(container);
      });
    }

    loadData();
  </script>

  <script>
    // üü° ‡πÅ‡∏ó‡πá‡∏ö
    function openTab(tabId) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.querySelector(`.tab-btn[onclick*="${tabId}"]`).classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    // üåó ‡∏ò‡∏µ‡∏°‡∏ã‡∏¥‡∏á‡∏Å‡πå
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") document.body.classList.add("dark");
  </script>
</body>
</html>
