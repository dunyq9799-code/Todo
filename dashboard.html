<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --cream-bg: #faf8f5;
      --dark-bg: #121212;
      --dark-card: #1e1e1e;
      --accent: #e0c097;
      --accent-hover: #d6b17c;
      --text-dark: #333;
      --text-light: #f8f8f8;
    }

    body {
      font-family: 'Sarabun', sans-serif;
      background: var(--cream-bg);
      color: var(--text-dark);
      transition: background 0.4s, color 0.4s;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    body.dark {
      background: var(--dark-bg);
      color: var(--text-light);
    }

    h1 {
      font-weight: 500;
      margin-bottom: 20px;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ To-Do */
    .back-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background-color: var(--accent);
      border: none;
      color: #fff;
      font-size: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      cursor: pointer;
    }

    .back-btn:hover {
      background-color: var(--accent-hover);
      transform: scale(1.1);
    }

    /* üü° ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ß‡∏á‡∏Å‡∏•‡∏° */
    .progress-circle {
      position: relative;
      width: 180px;
      height: 180px;
      margin: 30px auto;
    }

    .progress-circle svg {
      transform: rotate(-90deg);
      width: 180px;
      height: 180px;
    }

    .progress-circle circle {
      fill: none;
      stroke-width: 14;
      stroke-linecap: round;
    }

    .progress-bg {
      stroke: #e8e4dc;
    }

    .progress-bar {
      stroke: var(--accent);
      stroke-dasharray: 440;
      stroke-dashoffset: 440;
      transition: stroke-dashoffset 1s ease;
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      font-weight: 600;
      color: var(--text-dark);
    }

    body.dark .progress-text {
      color: var(--text-light);
    }

    /* üìä ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå */
    .chart-line {
      width: 100%;
      height: 180px;
      background: linear-gradient(to bottom, #fefaf4, #faf8f5);
      border-radius: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    body.dark .chart-line {
      background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
    }

    .bar {
      width: 10%;
      background-color: var(--accent);
      border-radius: 4px 4px 0 0;
      transition: height 0.5s ease;
    }

    .bar-label {
      font-size: 13px;
      margin-top: 5px;
      color: #666;
    }

    body.dark .bar-label {
      color: #ccc;
    }

    /* üßÆ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏£‡∏∏‡∏õ */
    .summary-box {
      max-width: 500px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      text-align: left;
    }

    body.dark .summary-box {
      background: var(--dark-card);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
      font-size: 15px;
    }

    body.dark .summary-item {
      border-color: #333;
    }

    @media (max-width: 768px) {
      h1 { font-size: 1.4em; }
      .progress-circle {
        width: 140px;
        height: 140px;
      }
      .progress-circle svg {
        width: 140px;
        height: 140px;
      }
      .summary-box { font-size: 14px; padding: 15px; }
    }
  </style>
</head>

<body>
  <h1>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>

  <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå -->
  <div class="progress-circle">
    <svg>
      <circle class="progress-bg" cx="90" cy="90" r="70"></circle>
      <circle class="progress-bar" cx="90" cy="90" r="70"></circle>
    </svg>
    <div class="progress-text" id="progressTextCircle">0%</div>
  </div>

  <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
  <div class="summary-box" id="summaryBox">
    <div class="summary-item"><span>‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span><strong>0</strong></div>
    <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span><strong>0</strong></div>
    <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</span><strong>0</strong></div>
    <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏ß‡∏î ‚Äú‡∏á‡∏≤‡∏ô‚Äù</span><strong>0</strong></div>
    <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏ß‡∏î ‚Äú‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‚Äù</span><strong>0</strong></div>
  </div>

  <h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏£‡∏≠‡∏ö 7 ‡∏ß‡∏±‡∏ô</h3>
  <div class="chart-line" id="chartLine"></div>

  <button class="back-btn" onclick="window.location.href='index.html'">‚¨ÖÔ∏è</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const app = initializeApp({
      apiKey: "AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
      authDomain: "my-todo-list-9d2fa.firebaseapp.com",
      projectId: "my-todo-list-9d2fa"
    });
    const db = getFirestore(app);

    // üåó ‡πÉ‡∏ä‡πâ‡∏ò‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
    }

    // üìä ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    async function loadSummary() {
      const snapshot = await getDocs(collection(db, "tasks"));
      const tasks = [];
      let done = 0, work = 0, personal = 0;

      snapshot.forEach(doc => {
        const data = doc.data();
        tasks.push(data);
        if (data.completed) done++;
        if (data.category === "work") work++;
        if (data.category === "personal") personal++;
      });

      const total = tasks.length;
      const percent = total ? Math.round((done / total) * 100) : 0;
      const remain = total - done;

      // ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
      const circle = document.querySelector(".progress-bar");
      const offset = 440 - (440 * percent) / 100;
      circle.style.strokeDashoffset = offset;
      document.getElementById("progressTextCircle").textContent = percent + "%";

      // ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô
      const summaryBox = document.getElementById("summaryBox");
      summaryBox.innerHTML = `
        <div class="summary-item"><span>‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span><strong>${total}</strong></div>
        <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span><strong>${done}</strong></div>
        <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</span><strong>${remain}</strong></div>
        <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏ß‡∏î ‚Äú‡∏á‡∏≤‡∏ô‚Äù</span><strong>${work}</strong></div>
        <div class="summary-item"><span>‡∏á‡∏≤‡∏ô‡∏´‡∏°‡∏ß‡∏î ‚Äú‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‚Äù</span><strong>${personal}</strong></div>
      `;

      // üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
      const chart = document.getElementById("chartLine");
      const today = new Date();
      const days = [...Array(7)].map((_, i) => {
        const d = new Date(today);
        d.setDate(today.getDate() - (6 - i));
        return d.toISOString().slice(0, 10);
      });

      const data = days.map(day =>
        tasks.filter(t => t.completed && new Date(t.createdAt).toISOString().slice(0, 10) === day).length
      );

      chart.innerHTML = "";
      const maxVal = Math.max(...data, 1);
      days.forEach((day, i) => {
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.height = `${(data[i] / maxVal) * 100}%`;
        const label = document.createElement("div");
        label.className = "bar-label";
        label.textContent = new Date(day).toLocaleDateString("th-TH", { weekday: "short" });
        const container = document.createElement("div");
        container.style.display = "flex";
        container.style.flexDirection = "column";
        container.style.alignItems = "center";
        container.appendChild(bar);
        container.appendChild(label);
        chart.appendChild(container);
      });
    }

    loadSummary();
  </script>
</body>
</html>
