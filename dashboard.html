<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --cream-bg: #faf8f5;
      --dark-bg: #121212;
      --dark-card: #1e1e1e;
      --accent: #e0c097;
      --accent-hover: #d6b17c;
      --text-dark: #333;
      --text-light: #f8f8f8;
    }

    body {
      font-family: 'Sarabun', sans-serif;
      background: var(--cream-bg);
      color: var(--text-dark);
      transition: background 0.4s, color 0.4s;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    body.dark { background: var(--dark-bg); color: var(--text-light); }

    h1 { font-weight: 500; margin-bottom: 20px; }

    /* ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏° */
    .progress-circle {
      position: relative;
      width: 140px;
      height: 140px;
      margin: 30px auto;
    }
    .progress-circle svg {
      transform: rotate(-90deg);
      width: 140px;
      height: 140px;
    }
    .progress-circle circle {
      fill: none;
      stroke-width: 12;
      stroke-linecap: round;
    }
    .progress-bg { stroke: #e8e4dc; }
    .progress-bar {
      stroke: var(--accent);
      stroke-dasharray: 440;
      stroke-dashoffset: 440;
      transition: stroke-dashoffset 1s ease;
    }
    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      font-weight: 600;
      color: var(--text-dark);
    }
    body.dark .progress-text { color: var(--text-light); }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö */
    .back-btn {
      margin-top: 30px;
      padding: 12px 22px;
      border: none;
      background: var(--accent);
      color: #fff;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .back-btn:hover { background: var(--accent-hover); }

    /* ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå */
    .chart-line {
      width: 100%;
      height: 160px;
      background: linear-gradient(to bottom, #fefaf4, #faf8f5);
      border-radius: 12px;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 10px;
    }
    body.dark .chart-line {
      background: linear-gradient(to bottom, #2a2a2a, #1a1a1a);
    }
    .bar { width: 10%; background-color: var(--accent); border-radius: 4px 4px 0 0; transition: height 0.5s ease; }
    .bar-label { font-size: 12px; color: #666; margin-top: 5px; }
    body.dark .bar-label { color: #ccc; }
  </style>
</head>

<body>
  <h1>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>

  <div class="progress-circle">
    <svg>
      <circle class="progress-bg" cx="70" cy="70" r="70"></circle>
      <circle class="progress-bar" cx="70" cy="70" r="70"></circle>
    </svg>
    <div class="progress-text" id="progressTextCircle">0%</div>
  </div>

  <h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏£‡∏≠‡∏ö 7 ‡∏ß‡∏±‡∏ô</h3>
  <div class="chart-line" id="chartLine"></div>

  <button class="back-btn" onclick="window.location.href='index.html'">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ To-Do</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const app = initializeApp({
      apiKey: "AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
      authDomain: "my-todo-list-9d2fa.firebaseapp.com",
      projectId: "my-todo-list-9d2fa"
    });
    const db = getFirestore(app);

    async function loadSummary() {
      const snapshot = await getDocs(collection(db, "tasks"));
      const tasks = [];
      let done = 0;
      snapshot.forEach(doc => {
        const data = doc.data();
        tasks.push(data);
        if (data.completed) done++;
      });

      const total = tasks.length;
      const percent = total ? Math.round((done / total) * 100) : 0;

      const circle = document.querySelector(".progress-bar");
      const offset = 440 - (440 * percent) / 100;
      circle.style.strokeDashoffset = offset;
      document.getElementById("progressTextCircle").textContent = percent + "%";

      // weekly trend
      const chart = document.getElementById("chartLine");
      const today = new Date();
      const days = [...Array(7)].map((_, i) => {
        const d = new Date(today);
        d.setDate(today.getDate() - (6 - i));
        return d.toISOString().slice(0, 10);
      });
      const data = days.map(day =>
        tasks.filter(t => t.completed && new Date(t.createdAt).toISOString().slice(0, 10) === day).length
      );
      chart.innerHTML = "";
      const maxVal = Math.max(...data, 1);
      days.forEach((day, i) => {
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.height = `${(data[i] / maxVal) * 100}%`;
        const label = document.createElement("div");
        label.className = "bar-label";
        label.textContent = new Date(day).toLocaleDateString("th-TH", { weekday: "short" });
        const container = document.createElement("div");
        container.style.display = "flex";
        container.style.flexDirection = "column";
        container.style.alignItems = "center";
        container.appendChild(bar);
        container.appendChild(label);
        chart.appendChild(container);
      });
    }

    loadSummary();
  </script>
</body>
</html>
