<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TodoTask Pro ‚Äì Dashboard of the Gods</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg-light: #faf8f5;
      --bg-dark: #1f1f1f;
      --card-light: #fff;
      --card-dark: #2a2a2a;
      --accent: #e0c097;
      --text-dark: #333;
      --text-light: #f5f5f5;
      --shadow: rgba(0,0,0,0.1);
    }
    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0;
      background: var(--bg-light);
      color: var(--text-dark);
      transition: 0.4s ease;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-light);
    }

    header {
      text-align: center;
      padding: 25px 10px;
    }
    header h1 {
      font-weight: 600;
      color: var(--accent);
      margin: 0;
    }

    .motivation {
      text-align: center;
      font-style: italic;
      margin-bottom: 10px;
      color: #777;
    }
    body.dark .motivation { color: #aaa; }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .card {
      background: var(--card-light);
      border: 1px solid var(--accent);
      border-radius: 14px;
      box-shadow: 0 2px 6px var(--shadow);
      padding: 15px;
      transition: 0.3s;
    }
    .card:hover { transform: translateY(-5px); }
    body.dark .card { background: var(--card-dark); }

    canvas { width: 100%; max-height: 300px; }

    /* XP Bar */
    .xp-bar {
      width: 100%;
      height: 14px;
      background: #e8e4dc;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 10px;
    }
    .xp-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.6s ease;
    }

    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      font-size: 24px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: 0.3s;
    }
    .theme-toggle:hover { transform: scale(1.1); }

    @media (max-width: 768px) {
      canvas { max-height: 250px; }
    }
  </style>
</head>

<body>
  <header>
    <h1>üìä Dashboard</h1>
    <div class="motivation" id="motivation"></div>
  </header>

  <div class="dashboard">
    <div class="card">
      <h3>üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
      <p id="goalText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
      <div class="xp-bar"><div class="xp-fill" id="goalFill"></div></div>
    </div>

    <div class="card">
      <h3>ü•ß ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
      <canvas id="pieChart"></canvas>
    </div>

    <div class="card">
      <h3>üìÖ ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
      <canvas id="barChart"></canvas>
    </div>

    <div class="card">
      <h3>‚ö° ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
      <div id="energyText">0%</div>
      <div class="xp-bar"><div class="xp-fill" id="energyFill"></div></div>
    </div>
  </div>

  <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
      authDomain: "my-todo-list-9d2fa.firebaseapp.com",
      projectId: "my-todo-list-9d2fa",
      storageBucket: "my-todo-list-9d2fa.appspot.com",
      messagingSenderId: "631403892452",
      appId: "1:631403892452:web:66d382bf5f143fc05de6f1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const goalText = document.getElementById("goalText");
    const goalFill = document.getElementById("goalFill");
    const energyFill = document.getElementById("energyFill");
    const energyText = document.getElementById("energyText");

    let pieChart, barChart;

    // üîÅ Firestore Realtime Data
    onSnapshot(collection(db, "tasks"), (snapshot) => {
      const tasks = [];
      snapshot.forEach(doc => tasks.push({ id: doc.id, ...doc.data() }));
      updateCharts(tasks);
    });

    // üéØ Update Charts & Stats
    function updateCharts(tasks) {
      const done = tasks.filter(t => t.completed).length;
      const total = tasks.length;
      const percent = total ? Math.round((done / total) * 100) : 0;

      // ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
      goalText.textContent = `‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ${done}/${total} ‡∏á‡∏≤‡∏ô (${percent}%)`;
      goalFill.style.width = `${percent}%`;

      // Energy = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
      const energy = Math.min(100, done * 10);
      energyText.textContent = `${energy}%`;
      energyFill.style.width = `${energy}%`;

      // Pie Chart
      const pieData = {
        labels: ["‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß", "‡∏¢‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏á"],
        datasets: [{
          data: [done, total - done],
          backgroundColor: [ "#e0c097", "#d9d9d9" ]
        }]
      };
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(document.getElementById("pieChart"), {
        type: "doughnut",
        data: pieData,
        options: { plugins: { legend: { position: "bottom" } } }
      });

      // Weekly Bar Chart
      const today = new Date();
      const days = [...Array(7)].map((_, i) => {
        const d = new Date(today);
        d.setDate(today.getDate() - (6 - i));
        return d.toLocaleDateString("th-TH", { weekday: "short" });
      });
      const daily = Array(7).fill(0);
      tasks.forEach(t => {
        if (t.completed && t.createdAt) {
          const date = new Date(t.createdAt);
          const diff = Math.floor((today - date) / (1000*60*60*24));
          if (diff < 7 && diff >= 0) daily[6 - diff]++;
        }
      });
      if (barChart) barChart.destroy();
      barChart = new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
          labels: days,
          datasets: [{
            label: "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à",
            data: daily,
            backgroundColor: "#e0c097"
          }]
        },
        options: { scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
      });
    }

    // üåô Theme Sync
    function toggleTheme() {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      document.querySelector(".theme-toggle").textContent = isDark ? "üåô" : "‚òÄÔ∏è";
    }
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
      document.querySelector(".theme-toggle").textContent = "üåô";
    }

    // üí¨ Motivation Quotes
    const quotes = [
      "‚Äú‡∏ó‡∏∏‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‚Äù",
      "‚Äú‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏¢‡∏∏‡∏î ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‚Äù",
      "‚Äú‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏á‚Äù",
      "‚Äú‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‚Äù"
    ];
    document.getElementById("motivation").textContent =
      quotes[Math.floor(Math.random() * quotes.length)];
  </script>
</body>
</html>
