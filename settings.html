<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>TodoTask Pro ‚Äì Control Center</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent:#e0c097;
      --bg-light:#faf8f5;
      --bg-dark:#1f1f1f;
      --card-light:#fff;
      --card-dark:#2a2a2a;
      --text-dark:#333;
      --text-light:#f5f5f5;
    }
    body {
      font-family:'Sarabun',sans-serif;
      background:var(--bg-light);
      color:var(--text-dark);
      margin:0;
      transition:0.4s;
    }
    body.dark {background:var(--bg-dark);color:var(--text-light);}
    header{text-align:center;padding:25px 10px;}
    header h1{color:var(--accent);margin:0;}
    .container{
      max-width:700px;
      margin:auto;
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:25px;
    }
    .card{
      background:var(--card-light);
      border:1px solid var(--accent);
      border-radius:15px;
      padding:20px;
      transition:0.3s;
    }
    .card:hover{transform:translateY(-3px);}
    body.dark .card{background:var(--card-dark);}
    h3{margin-top:0;color:var(--accent);}
    .switch{
      display:flex;align-items:center;justify-content:space-between;
      background:rgba(255,255,255,0.1);
      padding:10px 15px;border-radius:10px;
    }
    button{
      background:var(--accent);color:#fff;border:none;
      border-radius:8px;padding:10px 15px;cursor:pointer;
      transition:0.3s;
    }
    button:hover{transform:scale(1.05);}
    .progress{height:14px;background:#e8e4dc;border-radius:10px;overflow:hidden;}
    .progress-fill{height:100%;width:0%;background:var(--accent);transition:width 0.5s;}
    .file-input{margin-top:10px;}
  </style>
</head>
<body>
  <header>
    <h1>‚öôÔ∏è Control Center</h1>
    <p id="aiHint"></p>
  </header>

  <div class="container">
    <!-- Theme -->
    <div class="card">
      <h3>üåó ‡∏ò‡∏µ‡∏° ‡πÅ‡∏≠‡∏õ</h3>
      <div class="switch">
        <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°</span>
        <select id="themeSelect">
          <option value="light">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á</option>
          <option value="dark">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</option>
          <option value="fusion">‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô</option>
        </select>
      </div>
    </div>

    <!-- Sound -->
    <div class="card">
      <h3>üéµ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
      <div class="switch">
        <span>‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏ö‡∏ö</span>
        <input type="checkbox" id="soundToggle">
      </div>
    </div>

    <!-- Goal -->
    <div class="card">
      <h3>üéØ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
      <input type="number" id="goalInput" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à" style="width:100%;padding:8px;">
      <button onclick="saveGoal()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
      <div class="progress"><div class="progress-fill" id="goalBar"></div></div>
      <p id="goalText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
    </div>

    <!-- Backup -->
    <div class="card">
      <h3>üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á / ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
      <button onclick="backupData()">üì§ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <input type="file" id="restoreFile" class="file-input" onchange="restoreData(event)">
    </div>

    <!-- Cloud -->
    <div class="card">
      <h3>‚òÅÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Cloud</h3>
      <p id="cloudStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</p>
    </div>

    <!-- XP -->
    <div class="card">
      <h3>‚ö° ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (XP)</h3>
      <input type="range" id="xpRange" min="5" max="50" value="10" oninput="updateXPValue()">
      <p>‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô : <span id="xpValue">10</span> XP / ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</p>
    </div>

    <button onclick="location.href='dashboard.html'">üìä ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
  </div>

  <script type="module">
    import {initializeApp} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import {getFirestore,getDocs,collection} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
      authDomain:"my-todo-list-9d2fa.firebaseapp.com",
      projectId:"my-todo-list-9d2fa"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Theme
    const themeSelect=document.getElementById('themeSelect');
    const soundToggle=document.getElementById('soundToggle');
    const xpRange=document.getElementById('xpRange');
    const xpValue=document.getElementById('xpValue');
    const goalBar=document.getElementById('goalBar');
    const goalText=document.getElementById('goalText');
    const cloudStatus=document.getElementById('cloudStatus');

    function applyTheme(mode){
      document.body.classList.remove('dark');
      if(mode==='dark')document.body.classList.add('dark');
      else if(mode==='fusion'){document.body.style.background='linear-gradient(to bottom,#faf4e8,#d4bfa1)';}
      localStorage.setItem('theme',mode);
    }
    themeSelect.addEventListener('change',()=>applyTheme(themeSelect.value));
    if(localStorage.getItem('theme')){themeSelect.value=localStorage.getItem('theme');applyTheme(themeSelect.value);}

    // Sound
    soundToggle.checked=localStorage.getItem('sound')==='on';
    soundToggle.addEventListener('change',()=>{
      localStorage.setItem('sound',soundToggle.checked?'on':'off');
    });

    // Goal
    function saveGoal(){
      const val=document.getElementById('goalInput').value;
      localStorage.setItem('goalTarget',val);
      updateGoalProgress();
    }
    async function updateGoalProgress(){
      const target=localStorage.getItem('goalTarget')||0;
      const snapshot=await getDocs(collection(db,'tasks'));
      const done=snapshot.docs.filter(d=>d.data().completed).length;
      const percent=target?Math.min(100,(done/target)*100):0;
      goalBar.style.width=percent+'%';
      goalText.textContent=`‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ${done}/${target} ‡∏á‡∏≤‡∏ô (${Math.round(percent)}%)`;
    }
    updateGoalProgress();

    // Backup / Restore
    async function backupData(){
      const snapshot=await getDocs(collection(db,'tasks'));
      const data=snapshot.docs.map(d=>d.data());
      const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='todo_backup.json';
      a.click();
    }
    function restoreData(e){
      const file=e.target.files[0];
      if(!file)return;
      const reader=new FileReader();
      reader.onload=()=>{alert('‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á Sync ‡πÉ‡∏´‡∏°‡πà)');};
      reader.readAsText(file);
    }

    // XP
    function updateXPValue(){
      xpValue.textContent=xpRange.value;
      localStorage.setItem('xpReward',xpRange.value);
    }
    updateXPValue();

    // Cloud status
    async function checkCloud(){
      try{
        const snapshot=await getDocs(collection(db,'tasks'));
        cloudStatus.textContent=`‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${snapshot.size} ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)`;
        cloudStatus.style.color='green';
      }catch(e){
        cloudStatus.textContent='‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase';
        cloudStatus.style.color='red';
      }
    }
    checkCloud();

    // AI Hint
    const hints=[
      "‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡πÄ‡∏≠‡∏á‚Äù",
      "‚Äú‡∏≠‡∏¢‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ß‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‚Äù",
      "‚Äú‡∏ó‡∏∏‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏µ‡∏Å +1 ‡∏£‡∏∞‡∏î‡∏±‡∏ö‚Äù",
      "‚Äú‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢ ‡∏û‡∏±‡∏Å‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏¢‡∏∏‡∏î‚Äù"
    ];
    document.getElementById('aiHint').textContent=hints[Math.floor(Math.random()*hints.length)];
  </script>
</body>
</html>
