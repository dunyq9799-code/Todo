<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>TodoTask Pro ‚Äì Universe View</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --accent:#e0c097;
  --bg-dark:#0a0a0c;
  --text-light:#f5f5f5;
}
body {
  font-family:'Sarabun',sans-serif;
  margin:0;
  overflow:hidden;
  background:radial-gradient(circle at center, #0f0f11 0%, #050507 100%);
  color:var(--text-light);
}
header{
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  z-index:10;
}
header h1{margin:0;color:var(--accent);}
.controls{
  position:absolute;
  bottom:20px;
  width:100%;
  display:flex;
  justify-content:center;
  gap:15px;
  z-index:10;
}
button{
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:50px;
  padding:10px 15px;
  cursor:pointer;
  transition:0.3s;
}
button:hover{transform:scale(1.1);}
#infoBox{
  position:absolute;
  top:80px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.6);
  border:1px solid var(--accent);
  padding:15px 20px;
  border-radius:12px;
  color:#fff;
  display:none;
  z-index:9;
}
</style>
</head>
<body>
<header>
  <h1>üåå ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏• TodoTask Pro</h1>
  <p>‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏Ñ‡∏∑‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏∏‡∏ì</p>
</header>

<div id="infoBox"></div>
<div class="controls">
  <button onclick="location.href='dashboard.html'">üìä ‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
  <button onclick="toggleMusic()">üéµ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
  <button onclick="resetCamera()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á</button>
</div>

<audio id="spaceMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/07/27/audio_0a424a5e56.mp3?filename=space-ambient-114397.mp3" type="audio/mpeg">
</audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/controls/OrbitControls.js"></script>
<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import {getFirestore,collection,getDocs} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyB_7tyj_BAyFzKEYVrZXfQjWCUXGS7VqKY",
  authDomain:"my-todo-list-9d2fa.firebaseapp.com",
  projectId:"my-todo-list-9d2fa"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

// üéá ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏â‡∏≤‡∏Å 3D
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);
camera.position.z=30;
const controls=new THREE.OrbitControls(camera,renderer.domElement);

// üåü ‡πÅ‡∏™‡∏á
const ambient=new THREE.AmbientLight(0xffffff,0.6);
scene.add(ambient);
const pointLight=new THREE.PointLight(0xffffff,1);
pointLight.position.set(10,10,10);
scene.add(pointLight);

// üé® ‡πÇ‡∏´‡∏•‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
const infoBox=document.getElementById('infoBox');
let stars=[];
async function loadStars(){
  const snapshot=await getDocs(collection(db,"tasks"));
  const tasks=snapshot.docs.map(d=>({id:d.id,...d.data()}));
  const geometry=new THREE.SphereGeometry(0.4,16,16);

  tasks.forEach((t,i)=>{
    const color=t.completed?0xffd580:(t.category==="personal"?0x91d8f7:0xe0c097);
    const material=new THREE.MeshStandardMaterial({
      color:color,
      emissive:t.completed?color:0x000000,
      emissiveIntensity:t.completed?0.6:0.2
    });
    const star=new THREE.Mesh(geometry,material);
    const radius=10+Math.random()*15;
    const angle=i*(Math.PI*2/tasks.length);
    star.position.set(
      Math.cos(angle)*radius,
      (Math.random()-0.5)*10,
      Math.sin(angle)*radius
    );
    star.userData=t;
    scene.add(star);
    stars.push(star);
  });
}
await loadStars();

// ‚ú® ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏°‡∏∏‡∏ô‡∏≠‡πà‡∏≠‡∏ô ‡πÜ
function animate(){
  requestAnimationFrame(animate);
  stars.forEach(s=>s.rotation.y+=0.01);
  renderer.render(scene,camera);
}
animate();

// üìã ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
window.addEventListener('click',(e)=>{
  const raycaster=new THREE.Raycaster();
  const mouse=new THREE.Vector2(
    (e.clientX/window.innerWidth)*2-1,
    -(e.clientY/window.innerHeight)*2+1
  );
  raycaster.setFromCamera(mouse,camera);
  const intersects=raycaster.intersectObjects(stars);
  if(intersects.length>0){
    const t=intersects[0].object.userData;
    infoBox.innerHTML=`
      <b>‡∏ä‡∏∑‡πà‡∏≠:</b> ${t.text}<br>
      <b>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</b> ${t.category}<br>
      <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${t.completed?"‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß":"‚åõ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à"}<br>
      <small>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date(t.createdAt).toLocaleDateString("th-TH")}</small>
    `;
    infoBox.style.display='block';
  }else infoBox.style.display='none';
});

// üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á
const music=document.getElementById('spaceMusic');
function toggleMusic(){music.paused?music.play():music.pause();}
function resetCamera(){
  camera.position.set(0,0,30);
  controls.update();
}
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
